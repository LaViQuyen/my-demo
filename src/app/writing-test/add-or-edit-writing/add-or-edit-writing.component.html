<div class="writing-layout">
  
  <!-- <div class="test-toolbar">
    
    <div class="left-tools">
      @if (state["isTesting"]) {
        <div class="timer-box">
          <span class="icon">‚è≥</span> 
          <span class="time">{{ minutes }}:{{ seconds | number: "2.0" }}</span>
        </div>
      }
    </div>

    <div class="center-tools">
      @if (state["isEditing"]) {
        <input class="tool-input" placeholder="Test Name" [(ngModel)]="data.name">
        <input class="tool-input small" type="number" placeholder="Min" [(ngModel)]="data.timeout">
      }
    </div>

    <div class="right-tools">
      @if (state["isTesting"] && !isReady) {
        <div class="start-group">
          <input class="name-input" placeholder="Enter Your Name" [(ngModel)]="data.studentName" />
          <button mat-flat-button color="primary" class="start-btn"
            [disabled]="!data.studentName || data.studentName === ''" 
            (click)="onStart()">
            START
          </button>
        </div>
      }

      @if ((state["isTesting"] && isReady) || state["isReadOnly"]) {
        <div class="candidate-badge">
          Candidate: <b>{{ data.studentName }}</b>
        </div>
      }
    </div>

  </div> -->

  <div class="test-body">
    
    @if (state["isTesting"] && !isReady) {
      <div class="welcome-screen">
        <div class="welcome-content">
          <h3>Welcome to Writing Test</h3>
          <p>Please enter your name in the top right corner to begin.</p>
        </div>
      </div>
    }

    @if (isReady || state["isReadOnly"] || state["isEditing"]) {
      <div class="active-test-area">
        @if (data.parts && data.parts.length > 0) {
          <app-writing
            class="writing-instance"
            [data]="data.parts[selectedPartIndex]" 
            [isSaved]="mapSavedPart[selectedPartIndex]!"
            [isEditing]="state['isEditing']"
            [isTesting]="state['isTesting']"
            [isReadOnly]="state['isReadOnly']">
          </app-writing>
        }
      </div>
    }
  </div>

  @if (isReady || state["isReadOnly"] || state["isEditing"]) {
    <div class="test-footer">
      <div class="tabs-area">
        @for (part of data.parts; track $index) {
          <button class="tab-btn" 
                  [class.active]="selectedPartIndex === $index"
                  (click)="selectedPartIndex = $index">
            Part {{ $index + 1 }}
          </button>
        }
        @if (state["isEditing"]) {
          <button class="add-btn" (click)="onAddPart()">+</button>
        }
      </div>

      <div class="actions-area">
        @if (state["isEditing"]) {
          <button mat-raised-button color="accent" (click)="onSaveClick()">Save</button>
        }
        @if (state["isTesting"]) {
          <button mat-raised-button color="warn" (click)="onSubmit()">Submit</button>
        }
      </div>
    </div>
  }
</div>