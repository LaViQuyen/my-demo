<div class="writing-container">
  
  @if (state["isTesting"] && !isReady) {
    <div class="welcome-screen">
      <mat-card class="welcome-card">
        <div class="card-content">
          <mat-icon class="icon">edit_note</mat-icon>
          <h2>Writing Test Simulation</h2>
          <p>Please enter your name to begin the test.</p>
          
          <div class="input-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Full Name</mat-label>
              <input matInput [(ngModel)]="data.studentName" placeholder="Ex: Nguyen Van A" required>
            </mat-form-field>
          </div>

          <button mat-flat-button color="primary" class="start-btn"
            [disabled]="!data.studentName" 
            (click)="onStart()">
            START TEST
          </button>
        </div>
      </mat-card>
    </div>
  }

  @if (isReady || state["isReadOnly"] || state["isEditing"]) {
    <div class="test-content">
      @if (state["isEditing"]) {
        <div class="edit-toolbar">
          <input class="simple-input" placeholder="Test Name" [(ngModel)]="data.name">
          <input class="simple-input small" type="number" placeholder="Mins" [(ngModel)]="data.timeout">
        </div>
      }

      @if (data.parts && data.parts.length > 0) {
        <app-writing
          class="writing-instance"
          [data]="data.parts[selectedPartIndex]" 
          [isSaved]="mapSavedPart[selectedPartIndex]!"
          [isEditing]="state['isEditing']"
          [isTesting]="state['isTesting']"
          [isReadOnly]="state['isReadOnly']"
          (writingChange)="onWritingChange($any($event))"> </app-writing>
      }
    </div>
  }

  @if (isReady || state["isReadOnly"] || state["isEditing"]) {
    <div class="footer-bar">
      <div class="tabs-list">
        @for (part of data.parts; track $index) {
          <button class="tab-btn" 
                  [class.active]="selectedPartIndex === $index"
                  (click)="selectedPartIndex = $index">
            Part {{ $index + 1 }}
          </button>
        }
        @if (state["isEditing"]) {
          <button class="add-btn" (click)="onAddPart()">+</button>
        }
      </div>

      <div class="word-count-info">
        Word Count: <b>{{ data.wordCount || 0 }}</b>
      </div>

      <div class="action-btns">
        @if (state["isEditing"]) {
          <button mat-raised-button color="accent" (click)="onSaveClick()">Save & Exit</button>
        }
        @if (state["isTesting"]) {
          <button mat-raised-button color="warn" (click)="onSubmit()">Submit</button>
        }
      </div>
    </div>
  }

</div>